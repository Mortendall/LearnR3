---
title: "Draft R Markdown document"
author: "Morten Dall"
output: html_document
---
##import raw data
```{r setup}
library(vroom)
library(here)
library(tidyverse)
library(fs)

options(dplyr.summarise.inform = FALSE)

```

```{r}
user_1_info_file <- here("data-raw/mmash/user_1/user_info.csv")
user_1_info_data <- vroom(
  user_1_info_file,
  col_select = -1,
  col_types = cols(
    Gender = col_character(),
    Weight = col_double(),
    Height = col_double(),
    Age = col_double()
  ),
  .name_repair = snakecase::to_snake_case)

user_1_info_data
                          
  ```
```

##Exercise: import of saliva data

```{r}
user_1_saliva_file <- here("data-raw/mmash/user_1/saliva.csv")
user_1_saliva_data_prep <- vroom(user_1_saliva_file,
                                 col_select = -1)

spec(user_1_saliva_data_prep)

user_1_saliva_data <- vroom(
    user_1_saliva_file,
    col_select = -1,
    col_types = cols(
  SAMPLES = col_character(),
  `Cortisol NORM` = col_double(),
  `Melatonin NORM` = col_double()),
    .name_repair = snakecase::to_snake_case
)

user_1_saliva_data
```





##Exercise: Import the Actigraph data
```{r}
import_actigraph_data(here("data-raw/mmash/user_1/actigraph.csv"))

```
##importing all the user_info files
```{r}
user_info_files <- dir_ls(here("data-raw/mmash/"),
                          regexp = "user_info.csv",
                          recurse = T)
user_info_list <- purrr::map_dfr(user_info_files, import_user_info, .id = "file_path_id")
View(user_info_list)
```

##Exercise Map the other datasets
```{r import data files}

user_data <- import_multiple_files("user_info.csv", import_user_info)
saliva_df <- import_multiple_files("saliva.csv", import_saliva_data)
actigraph_df <- import_multiple_files("Actigraph.csv", import_actigraph_data)
rr_df <- import_multiple_files("RR.csv", import_rr_data)

```


##remove file path and add user ID


```{r}


summarized_rr_df <- rr_df %>% 
  group_by(user_id, day) %>% 
  summarise(across(ibi_s, list(mean=mean, sd=sd), na.rm = T))
View(summarized_rr_df)
summarized_rr_df



saliva_with_day_df <- saliva_df %>% 
  dplyr::mutate(day = case_when(
    samples == "before sleep" ~ 1,
    samples == "wake up" ~ 2,
    TRUE ~ NA_real_
  ))

saliva_with_day_df
```

##Exercise: Summarize and join the Actigraph data 
```{r}
actigraph_df_sum <- actigraph_df %>%
  select(-c(axis_1,axis_2,axis_3, inclinometer_off,inclinometer_standing, inclinometer_sitting, inclinometer_lying)) %>% 
  group_by(user_id, day) %>% 
  summarise(across(c(steps, hr, vector_magnitude), list(mean = mean, sd = sd), na.rm = T))
  

view(actigraph_df_sum)
combined_data <- reduce(list(user_data, saliva_with_day_df, summarized_rr_df, actigraph_df_sum), full_join)

View(combined_data)
```

##Exercise importing activity data
```{r}
activity_data_file <- here("data-raw/mmash/user_1/activity.csv")

import_activity_data(here("data-raw/mmash/user_1/activity.csv"))

activity_data <- import_multiple_files("Activity.csv", import_activity_data)

activity_data <- activity_data %>% 
  dplyr::mutate(activity_seconds = end-start)

#attempt to summarize the activity data

activity_data_sum <- activity_data %>%
  group_by(day, user_id, activity) %>% 
  summarise(across(activity_seconds, list(sum = sum, sd = sd)))

View(activity_data_sum)

#join with the combined data

grand_data <- reduce(list(combined_data, activity_data_sum), full_join)
View(grand_data)
```

##the essential lines of code
```{r essentials}
user_data <- import_multiple_files("user_info.csv", import_user_info)
saliva_df <- import_multiple_files("saliva.csv", import_saliva_data)
actigraph_df <- import_multiple_files("Actigraph.csv", import_actigraph_data)
rr_df <- import_multiple_files("RR.csv", import_rr_data)

summarized_rr_df <- rr_df %>% 
  group_by(user_id, day) %>% 
  summarise(across(ibi_s, list(mean=mean, sd=sd), na.rm = T))
View(summarized_rr_df)
summarized_rr_df



saliva_with_day_df <- saliva_df %>% 
  mutate(day = case_when(
    samples == "before sleep" ~ 1,
    samples == "wake up" ~ 2,
    TRUE ~ NA_real_
  ))

```

